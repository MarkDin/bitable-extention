const _="https://open.feishu.cn/open-apis/bot/v2/hook/5b3ac02c-c18f-4263-af51-abaf655dbbac",c={template_id:"AAqIYhbgzY69r",template_version_name:"1.0.3"},a={FIELD_LIST:"field_list",COMPLETE_ROW_COUNT:"complete_row_count",START_TIME:"start_time",END_TIME:"end_time",COMPLETE_RESULT:"complete_result",DOC_LINK:"doc_link",USER_OPEN_ID:"user"};function m(){return!0}async function T(r){try{if(!m())return console.error("[SendLarkMessage] å¡ç‰‡æ¨¡æ¿é…ç½®æ— æ•ˆï¼Œè¯·æ£€æŸ¥ template_id"),!1;const s=t=>new Date(t).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:"Asia/Shanghai"}),d=t=>{let e="";switch(t.status){case"success":e="âœ…å…¨éƒ¨æ­£ç¡®";break;case"partial":e=`âš ï¸éƒ¨åˆ†æˆåŠŸï¼šæˆåŠŸ${t.successCount}è¡Œï¼Œå¤±è´¥${t.errorCount}è¡Œ`;break;case"failed":e=`âŒè¡¥å…¨å¤±è´¥ï¼š${t.errorCount}è¡Œå¤±è´¥`;break;case"no_permission":e="ğŸ”’æƒé™ä¸è¶³";break;case"noChange":e="ğŸ“æ— éœ€æ›´æ–°";break;default:e="ğŸ“Šå¤„ç†å®Œæˆ";break}return t.fieldCreationErrors&&t.fieldCreationErrors.length>0&&(e+=`
ğŸ”§å­—æ®µåˆ›å»ºé—®é¢˜ï¼š${t.fieldCreationErrors.join("ï¼›")}`),e},l=`è¡¥å…¨${r.selectedFields.length}ä¸ªå­—æ®µ: ${r.selectedFields.join("ã€")}`,i={msg_type:"interactive",card:{type:"template",data:{template_id:c.template_id,template_version_name:c.template_version_name,template_variable:{[a.FIELD_LIST]:l,[a.COMPLETE_ROW_COUNT]:r.totalRows,[a.START_TIME]:s(r.submitTime),[a.END_TIME]:s(r.endTime),[a.COMPLETE_RESULT]:d(r.completionResult),[a.DOC_LINK]:r.bitableUrl,...r.user&&{[a.USER_OPEN_ID]:{id:r.user.id}}}}}};console.log("[SendLarkMessage] å‘é€é£ä¹¦å¡ç‰‡æ¨¡æ¿:",JSON.stringify(i,null,2));const n=await fetch(_,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!n.ok){const t=await n.text();console.error("[SendLarkMessage] å‘é€å¤±è´¥:",n.status,t);try{const e=JSON.parse(t);e.msg&&console.error("[SendLarkMessage] é”™è¯¯è¯¦æƒ…:",e.msg)}catch{}return!1}const o=await n.json();return console.log("[SendLarkMessage] å‘é€æˆåŠŸ:",o),o.code!==0?(console.error("[SendLarkMessage] ä¸šåŠ¡é”™è¯¯:",o.msg),!1):!0}catch(s){return console.error("[SendLarkMessage] å‘é€æ“ä½œæ—¥å¿—å¤±è´¥:",s),!1}}export{T as sendOperationLogToFeishu};
