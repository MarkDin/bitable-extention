const _="https://open.feishu.cn/open-apis/bot/v2/hook/5b3ac02c-c18f-4263-af51-abaf655dbbac",c={template_id:"AAqIYhbgzY69r",template_version_name:"1.0.0"},r={FIELD_LIST:"field_list",COMPLETE_ROW_COUNT:"complete_row_count",START_TIME:"start_time",END_TIME:"end_time",COMPLETE_RESULT:"complete_result",DOC_LINK:"doc_link"};function m(){return!0}async function u(t){try{if(!m())return console.error("[SendLarkMessage] å¡ç‰‡æ¨¡æ¿é…ç½®æ— æ•ˆï¼Œè¯·æ£€æŸ¥ template_id"),!1;const s=e=>new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:"Asia/Shanghai"}),l=e=>{switch(e.status){case"success":return"âœ…å…¨éƒ¨æ­£ç¡®";case"partial":return`âš ï¸éƒ¨åˆ†æˆåŠŸï¼šæˆåŠŸ${e.successCount}è¡Œï¼Œå¤±è´¥${e.errorCount}è¡Œ`;case"failed":return`âŒè¡¥å…¨å¤±è´¥ï¼š${e.errorCount}è¡Œå¤±è´¥`;case"no_permission":return"ğŸ”’æƒé™ä¸è¶³";case"noChange":return"ğŸ“æ— éœ€æ›´æ–°";default:return"ğŸ“Šå¤„ç†å®Œæˆ"}},d=`è¡¥å…¨${t.selectedFields.length}ä¸ªå­—æ®µ: ${t.selectedFields.join("ã€")}`,i={msg_type:"interactive",card:{type:"template",data:{template_id:c.template_id,template_version_name:c.template_version_name,template_variable:{[r.FIELD_LIST]:d,[r.COMPLETE_ROW_COUNT]:t.totalRows,[r.START_TIME]:s(t.submitTime),[r.END_TIME]:s(t.endTime),[r.COMPLETE_RESULT]:l(t.completionResult),[r.DOC_LINK]:t.bitableUrl}}}};console.log("[SendLarkMessage] å‘é€é£ä¹¦å¡ç‰‡æ¨¡æ¿:",JSON.stringify(i,null,2));const n=await fetch(_,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!n.ok){const e=await n.text();console.error("[SendLarkMessage] å‘é€å¤±è´¥:",n.status,e);try{const a=JSON.parse(e);a.msg&&console.error("[SendLarkMessage] é”™è¯¯è¯¦æƒ…:",a.msg)}catch{}return!1}const o=await n.json();return console.log("[SendLarkMessage] å‘é€æˆåŠŸ:",o),o.code!==0?(console.error("[SendLarkMessage] ä¸šåŠ¡é”™è¯¯:",o.msg),!1):!0}catch(s){return console.error("[SendLarkMessage] å‘é€æ“ä½œæ—¥å¿—å¤±è´¥:",s),!1}}export{u as sendOperationLogToFeishu};
